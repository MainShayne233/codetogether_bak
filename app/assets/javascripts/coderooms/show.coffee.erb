ready = ->

  window.whiteboard = CodeMirror.fromTextArea($('.code').get(0), {
    lineNumbers: true,
    mode: "text/x-ruby",
    theme: 'base16-dark',
    tabSize: 2
  });

#  window.output = CodeMirror.fromTextArea($('.code').get(0), {
#    lineNumbers: true,
#    mode: "text/x-ruby",
#    theme: 'base16-dark',
#    tabSize: 2
#  });

  window.whiteboard.on 'keyup', (event) ->
    id = $('.code_container').attr('id')
    content = event.getValue()
    user_id = $('input.user').attr('id')

    $.ajax({
      type: 'PATCH',
      url: '/whiteboards/' + id
      data: {content: content},
      datatype: 'JSON'
    })

    App.coderoom.type(id, content, user_id)


  $('#run_script').click ->
    id = $('.code_container').attr('id')
    $.ajax({
      type: 'GET',
      url: '/whiteboards/' + id + '/run',
      dataType: 'JSON'
      success: (data) ->
        $('#output').html(data.return)
    })


$(document).ready(ready)
$(document).on('page:change', ready)
